<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CHEF PRO</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<style>
body{margin:0;font-family:Arial;background:#111;color:#fff}
header{background:#000;padding:15px;text-align:center;font-size:22px;font-weight:bold}
nav{display:flex;justify-content:space-around;background:#1a1a1a;padding:10px}
nav button{background:none;border:none;color:#fff;font-size:16px}
section{padding:15px}
input,select,textarea,button{width:100%;margin-bottom:8px;padding:10px;border-radius:6px;border:none}
button{background:#fff;color:#000;font-weight:bold}
.card{background:#222;padding:10px;border-radius:6px;margin-bottom:10px}
.hidden{display:none}
.icon-btn{background:#333;color:#fff;font-size:18px}
img.thumb{max-width:100%;border-radius:8px;margin-bottom:8px}

@media print{
  nav,button,input,select,textarea,.no-print{display:none}

  body{
    background:#fff;
    color:#000;
    font-size:11px;
    margin:8mm;
  }

  h2{
    font-size:18px;
    margin:4px 0;
  }

  h3{
    font-size:14px;
    margin:4px 0;
  }

  p, div{
    margin:2px 0;
    line-height:1.2;
    page-break-inside:avoid;
  }

  #fotoScheda{
    display:flex;
    flex-wrap:wrap;
    gap:4mm;
    margin-bottom:6mm;
  }

  img.thumb{
    width:48%;
    max-height:90px;
    object-fit:cover;
    page-break-inside:avoid;
  }
}

  h2,h3{
    margin:4px 0;
  }

  img.thumb{
    max-width:45%;
    max-height:120px;
    object-fit:cover;
    display:inline-block;
    margin:4px;
    page-break-inside:avoid;
  }

  #fotoScheda{
    display:flex;
    flex-wrap:wrap;
    justify-content:flex-start;
  }

  .card, p, div{
    page-break-inside:avoid;
  }
}

</style>
</head>

<body>

<header>CHEF PRO</header>

<nav>
<button onclick="showPage('home')">NUOVA</button>
<button onclick="showPage('ricette')">RICETTE</button>
</nav>

<section id="home">
<h2>Nuova Ricetta</h2>

<input id="nome" placeholder="Nome ricetta">

<select id="categoria" onchange="toggleFoto()">
<option>Antipasti</option>
<option>Primi</option>
<option>Secondi</option>
<option>Dolci</option>
<option>Preparazioni base</option>
</select>

<h3>Ingredienti</h3>
<input id="ingInput" placeholder="Ingrediente">
<input id="ingQuantita" placeholder="Quantit√†">
<button onclick="aggiungiIngrediente()">Aggiungi ingrediente</button>
<div id="listaIngredienti"></div>

<h3>Procedimento</h3>
<div id="passaggi"></div>
<button onclick="aggiungiPassaggio()">‚ûï Aggiungi passaggio</button>

<input id="finitura" placeholder="Finitura del piatto">

<!-- FOTO -->
<div id="fotoSezione">
<button class="icon-btn no-print" onclick="fotoInput.click()">üì∑ Aggiungi foto del piatto</button>
<input type="file" id="fotoInput" accept="image/*" capture="environment" multiple class="hidden">
<div id="anteprime"></div>
<label class="no-print">
<input type="checkbox" id="stampaFoto"> Includi foto in stampa
</label>
</div>

<button onclick="salvaRicetta()">Salva ricetta</button>
</section>

<section id="ricette" class="hidden">
<input id="cerca" placeholder="Cerca ricetta..." oninput="cercaRicetta()">
<div id="listaRicette"></div>
</section>


<section id="scheda" class="hidden">
<h2 id="titolo"></h2>

<div class="no-print">
<button onclick="modificaRicetta(ricettaAperta)">‚úèÔ∏è Modifica</button>
<button onclick="eliminaRicetta(ricettaAperta)">üóëÔ∏è Elimina</button>
</div>

<div id="fotoScheda"></div>
<div id="ingredientiScheda"></div>
<div id="procedimentoScheda"></div>
<p id="finituraScheda"></p>

<button onclick="window.print()">üñ® Stampa</button>
</section>


<script>
let ricette=JSON.parse(localStorage.getItem("ricette"))||[];
let ingredientiTemp=[],passaggiTemp=[],fotoTemp=[];
let ricettaInModifica = null;
  

function showPage(id){
 document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
 if(id==="ricette")renderRicette();
}

function toggleFoto(){
 fotoSezione.classList.toggle("hidden",categoria.value==="Preparazioni base");
}

function aggiungiIngrediente(){
 if(!ingInput.value||!ingQuantita.value)return;
 ingredientiTemp.push({n:ingInput.value,q:ingQuantita.value});
 ingInput.value="";ingQuantita.value="";
 renderIngredienti();
}

function renderIngredienti(){
 listaIngredienti.innerHTML="";
 ingredientiTemp.forEach(i=>{
  listaIngredienti.innerHTML+=`<div class="card">${i.n} ‚Äì ${i.q}</div>`;
 });
}

function aggiungiPassaggio(){
 passaggiTemp.push("");
 renderPassaggi();
}

function renderPassaggi(){
 passaggi.innerHTML="";
 passaggiTemp.forEach((p,i)=>{
  passaggi.innerHTML+=
   `<textarea placeholder="Passaggio ${i+1}" oninput="passaggiTemp[${i}]=this.value">${p}</textarea>`;
 });
}

fotoInput.onchange=()=>{
 [...fotoInput.files].forEach(f=>{
  let r=new FileReader();
  r.onload=()=>{fotoTemp.push(r.result);renderFoto();};
  r.readAsDataURL(f);
 });
}

function renderFoto(){
 anteprime.innerHTML="";
 fotoTemp.forEach(f=>anteprime.innerHTML+=`<img src="${f}" class="thumb">`);
}

function salvaRicetta(){
 let nuova = {
  nome:nome.value,
  categoria:categoria.value,
  ingredienti:ingredientiTemp,
  procedimento:passaggiTemp,
  finitura:finitura.value,
  foto:fotoTemp,
  stampaFoto:stampaFoto.checked
 };

 if(ricettaInModifica !== null){
  ricette[ricettaInModifica] = nuova;
  ricettaInModifica = null;
 } else {
  ricette.push(nuova);
 }

 localStorage.setItem("ricette",JSON.stringify(ricette));
 location.reload();
}


function renderRicette(){
 listaRicette.innerHTML="";
 ricette.forEach((r,i)=>{
  let d=document.createElement("div");
  d.className="card";
  d.innerHTML = `<strong>${r.nome}</strong><br><small>${r.categoria}</small>`;
  d.onclick = ()=>mostraScheda(i);
  listaRicette.appendChild(d);
 });
}


function mostraScheda(i){
 let r=ricette[i];
 showPage("scheda");

 titolo.textContent=r.nome;
 ingredientiScheda.innerHTML =
  r.ingredienti.map(i=>`<div>${i.n} ‚Äì ${i.q}</div>`).join("");

 procedimentoScheda.innerHTML =
  r.procedimento.map((p,i)=>`<p>${i+1}. ${p}</p>`).join("");

 finituraScheda.textContent = r.finitura;

 fotoScheda.innerHTML = "";

 if(r.stampaFoto && r.foto.length){
  // SOLO 1 FOTO se sono troppe
  let fotoDaStampare = r.foto.slice(0,2);
  fotoDaStampare.forEach(f=>{
    fotoScheda.innerHTML += `<img src="${f}" class="thumb">`;
  });
 }
}
function modificaRicetta(i){
 let r = ricette[i];
 ricettaInModifica = i;

 showPage("home");

 nome.value = r.nome;
 categoria.value = r.categoria;
 ingredientiTemp = [...r.ingredienti];
 passaggiTemp = [...r.procedimento];
 finitura.value = r.finitura;
 fotoTemp = r.foto || [];
 stampaFoto.checked = r.stampaFoto || false;

 renderIngredienti();
 renderPassaggi();
 renderFoto();
}
function eliminaRicetta(i){
 if(confirm("Sei sicuro di voler eliminare questa ricetta?")){
  ricette.splice(i,1);
  localStorage.setItem("ricette",JSON.stringify(ricette));
  renderRicette();
 }
}
function cercaRicetta(){
 let t = cerca.value.toLowerCase();
 listaRicette.innerHTML = "";

 ricette
  .filter(r => r.nome.toLowerCase().includes(t))
  .forEach((r,i)=>{
    let d = document.createElement("div");
    d.className = "card";
    d.innerHTML = `<strong>${r.nome}</strong><br><small>${r.categoria}</small>`;
    d.onclick = () => mostraScheda(i);
    listaRicette.appendChild(d);
  });
}
</script>

</body>
</html>
