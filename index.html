<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CHEF PRO</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #111;
  color: #fff;
}
header {
  background: #000;
  padding: 15px;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
}
nav {
  display: flex;
  justify-content: space-around;
  background: #1a1a1a;
  padding: 10px;
}
nav button {
  background: none;
  border: none;
  color: #fff;
  font-size: 16px;
}
section {
  padding: 15px;
}
input, select, textarea, button {
  width: 100%;
  margin-bottom: 10px;
  padding: 10px;
  border-radius: 6px;
  border: none;
  font-size: 16px;
}
button {
  background: #fff;
  color: #000;
  font-weight: bold;
}
.card {
  background: #222;
  padding: 10px;
  border-radius: 6px;
  margin-bottom: 10px;
}
img {
  max-width: 100%;
  border-radius: 6px;
}
.hidden {
  display: none;
}
.small {
  font-size: 14px;
  opacity: 0.7;
}
</style>
</head>

<body>

<header>CHEF PRO</header>

<nav>
  <button onclick="showPage('home')">âž• Nuova</button>
  <button onclick="showPage('categorie')">ðŸ“‚ Categorie</button>
</nav>

<!-- HOME -->
<section id="home">
  <h2>Nuova Ricetta</h2>

  <input id="nome" placeholder="Nome ricetta">

  <select id="categoria"></select>

  <textarea id="descrizione" placeholder="Procedimento"></textarea>

  <input type="file" accept="image/*" capture="environment" id="foto">

  <button onclick="salvaRicetta()">Salva Ricetta</button>
</section>

<!-- CATEGORIE + RICERCA -->
<section id="categorie" class="hidden">
  <h2>Cerca Ricetta</h2>

  <input
    id="cerca"
    placeholder="Cerca in tutte le ricette..."
    oninput="cercaRicette()"
  >

  <div id="risultatiRicerca"></div>

  <h2>Categorie</h2>
  <div id="listaCategorie"></div>

  <input id="nuovaCategoria" placeholder="Nuova categoria">
  <button onclick="aggiungiCategoria()">Aggiungi categoria</button>
</section>

<!-- RICETTE PER CATEGORIA -->
<section id="ricette" class="hidden">
  <h2 id="titoloCategoria"></h2>
  <div id="listaRicette"></div>
</section>

<script>
let categorie = JSON.parse(localStorage.getItem("categorie")) || ["Antipasti", "Primi", "Secondi", "Dolci"];
let ricette = JSON.parse(localStorage.getItem("ricette")) || [];

function showPage(pagina) {
  document.querySelectorAll("section").forEach(s => s.classList.add("hidden"));
  document.getElementById(pagina).classList.remove("hidden");
}

function aggiornaSelectCategorie() {
  const select = document.getElementById("categoria");
  select.innerHTML = "";
  categorie.forEach(c => {
    const opt = document.createElement("option");
    opt.value = c;
    opt.textContent = c;
    select.appendChild(opt);
  });
}

function aggiungiCategoria() {
  const nome = document.getElementById("nuovaCategoria").value.trim();
  if (!nome) return;
  if (categorie.includes(nome)) return alert("Categoria giÃ  esistente");

  categorie.push(nome);
  localStorage.setItem("categorie", JSON.stringify(categorie));
  document.getElementById("nuovaCategoria").value = "";
  mostraCategorie();
  aggiornaSelectCategorie();
}

function mostraCategorie() {
  const div = document.getElementById("listaCategorie");
  div.innerHTML = "";
  categorie.forEach(c => {
    const card = document.createElement("div");
    card.className = "card";
    card.textContent = c;
    card.onclick = () => mostraRicetteCategoria(c);
    div.appendChild(card);
  });
}

function salvaRicetta() {
  const nome = document.getElementById("nome").value.trim();
  const categoria = document.getElementById("categoria").value;
  const descrizione = document.getElementById("descrizione").value.trim();
  const fotoInput = document.getElementById("foto");

  if (!nome) return alert("Inserisci il nome della ricetta");

  if (fotoInput.files[0]) {
    const reader = new FileReader();
    reader.onload = () => {
      ricette.push({ nome, categoria, descrizione, foto: reader.result });
      localStorage.setItem("ricette", JSON.stringify(ricette));
    };
    reader.readAsDataURL(fotoInput.files[0]);
  } else {
    ricette.push({ nome, categoria, descrizione });
    localStorage.setItem("ricette", JSON.stringify(ricette));
  }

  document.getElementById("nome").value = "";
  document.getElementById("descrizione").value = "";
  document.getElementById("foto").value = "";
}

function mostraRicetteCategoria(cat) {
  showPage("ricette");
  document.getElementById("titoloCategoria").textContent = cat;
  const div = document.getElementById("listaRicette");
  div.innerHTML = "";

  ricette.filter(r => r.categoria === cat).forEach(r => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <strong>${r.nome}</strong>
      <div class="small">${r.categoria}</div>
      ${r.foto ? `<img src="${r.foto}">` : ""}
      <p>${r.descrizione}</p>
    `;
    div.appendChild(card);
  });
}

function cercaRicette() {
  const testo = document.getElementById("cerca").value.toLowerCase();
  const risultati = document.getElementById("risultatiRicerca");
  risultati.innerHTML = "";

  if (!testo) return;

  ricette
    .filter(r =>
      r.nome.toLowerCase().includes(testo) ||
      (r.descrizione && r.descrizione.toLowerCase().includes(testo))
    )
    .forEach(r => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <strong>${r.nome}</strong>
        <div class="small">${r.categoria}</div>
        ${r.foto ? `<img src="${r.foto}">` : ""}
        <p>${r.descrizione}</p>
      `;
      risultati.appendChild(card);
    });
}

aggiornaSelectCategorie();
mostraCategorie();
</script>

</body>
</html>
