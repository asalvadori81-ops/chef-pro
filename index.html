<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CHEF PRO</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #111;
  color: #fff;
}
header {
  background: #000;
  padding: 15px;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
}
nav {
  display: flex;
  justify-content: space-around;
  background: #1a1a1a;
  padding: 10px;
}
nav button {
  background: none;
  border: none;
  color: #fff;
  font-size: 16px;
}
section {
  padding: 15px;
}
input, select, textarea, button {
  width: 100%;
  margin-bottom: 8px;
  padding: 10px;
  border-radius: 6px;
  border: none;
  font-size: 15px;
}
button {
  background: #fff;
  color: #000;
  font-weight: bold;
}
.card {
  background: #222;
  padding: 10px;
  border-radius: 6px;
  margin-bottom: 10px;
}
img {
  max-width: 100%;
  border-radius: 6px;
}
.hidden { display: none; }
.small { font-size: 14px; opacity: 0.7; }
.total {
  font-size: 18px;
  font-weight: bold;
  margin-top: 10px;
}
</style>
</head>

<body>

<header>CHEF PRO</header>

<nav>
  <button onclick="showPage('home')">âž• Nuova</button>
  <button onclick="showPage('categorie')">ðŸ“‚ Categorie</button>
</nav>

<!-- HOME -->
<section id="home">
  <h2>Nuova Ricetta</h2>
  <input id="nome" placeholder="Nome ricetta">
  <select id="categoria"></select>
  <textarea id="descrizione" placeholder="Procedimento"></textarea>
  <button onclick="salvaRicetta()">Salva Ricetta</button>
</section>

<!-- CATEGORIE + RICERCA -->
<section id="categorie" class="hidden">
  <input id="cerca" placeholder="Cerca in tutte le ricette..." oninput="cercaRicette()">
  <div id="risultatiRicerca"></div>

  <h3>Categorie</h3>
  <div id="listaCategorie"></div>

  <input id="nuovaCategoria" placeholder="Nuova categoria">
  <button onclick="aggiungiCategoria()">Aggiungi categoria</button>
</section>

<!-- RICETTA DETTAGLIO -->
<section id="ricetta" class="hidden">
  <h2 id="titoloRicetta"></h2>
  <p id="testoRicetta"></p>

  <h3>Ingredienti</h3>
  <input id="ingNome" placeholder="Ingrediente">
  <input id="ingCosto" type="number" placeholder="Costo â‚¬/kg o â‚¬/pz">
  <input id="ingQuantita" type="number" placeholder="QuantitÃ  usata">
  <button onclick="aggiungiIngrediente()">Aggiungi ingrediente</button>

  <div id="listaIngredienti"></div>
  <div class="total" id="totaleCosto"></div>
</section>

<script>
let categorie = JSON.parse(localStorage.getItem("categorie")) || ["Antipasti","Primi","Secondi","Dolci"];
let ricette = JSON.parse(localStorage.getItem("ricette")) || [];
let ricettaAttiva = null;

function showPage(id) {
  document.querySelectorAll("section").forEach(s => s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

function aggiornaCategorie() {
  const sel = document.getElementById("categoria");
  sel.innerHTML = "";
  categorie.forEach(c => {
    let o = document.createElement("option");
    o.value = c; o.textContent = c;
    sel.appendChild(o);
  });
}

function salvaRicetta() {
  const nome = document.getElementById("nome").value;
  const categoria = document.getElementById("categoria").value;
  const descrizione = document.getElementById("descrizione").value;
  if (!nome) return alert("Nome mancante");

  ricette.push({ nome, categoria, descrizione, ingredienti: [] });
  localStorage.setItem("ricette", JSON.stringify(ricette));
  document.getElementById("nome").value = "";
  document.getElementById("descrizione").value = "";
}

function mostraRicetta(r) {
  ricettaAttiva = r;
  showPage("ricetta");
  document.getElementById("titoloRicetta").textContent = r.nome;
  document.getElementById("testoRicetta").textContent = r.descrizione;
  aggiornaIngredienti();
}

function aggiungiIngrediente() {
  const n = document.getElementById("ingNome").value;
  const c = parseFloat(document.getElementById("ingCosto").value);
  const q = parseFloat(document.getElementById("ingQuantita").value);
  if (!n || !c || !q) return;

  ricettaAttiva.ingredienti.push({ nome:n, costo:c, quantita:q });
  localStorage.setItem("ricette", JSON.stringify(ricette));
  document.getElementById("ingNome").value="";
  document.getElementById("ingCosto").value="";
  document.getElementById("ingQuantita").value="";
  aggiornaIngredienti();
}

function aggiornaIngredienti() {
  const div = document.getElementById("listaIngredienti");
  div.innerHTML="";
  let totale = 0;

  ricettaAttiva.ingredienti.forEach(i => {
    const costo = (i.costo * i.quantita) / 1000;
    totale += costo;
    div.innerHTML += `<div class="card">${i.nome} - â‚¬ ${costo.toFixed(2)}</div>`;
  });

  document.getElementById("totaleCosto").textContent =
    "Costo totale ricetta: â‚¬ " + totale.toFixed(2);
}

function mostraCategorie() {
  const d = document.getElementById("listaCategorie");
  d.innerHTML="";
  categorie.forEach(c=>{
    const card=document.createElement("div");
    card.className="card";
    card.textContent=c;
    card.onclick=()=>ricette.filter(r=>r.categoria===c).forEach(mostraRicetta);
    d.appendChild(card);
  });
}

function aggiungiCategoria() {
  const n=document.getElementById("nuovaCategoria").value;
  if (!n) return;
  categorie.push(n);
  localStorage.setItem("categorie",JSON.stringify(categorie));
  document.getElementById("nuovaCategoria").value="";
  mostraCategorie();
  aggiornaCategorie();
}

function cercaRicette() {
  const t=document.getElementById("cerca").value.toLowerCase();
  const d=document.getElementById("risultatiRicerca");
  d.innerHTML="";
  if (!t) return;
  ricette.filter(r=>r.nome.toLowerCase().includes(t)).forEach(r=>{
    const c=document.createElement("div");
    c.className="card";
    c.textContent=r.nome+" ("+r.categoria+")";
    c.onclick=()=>mostraRicetta(r);
    d.appendChild(c);
  });
}

aggiornaCategorie();
mostraCategorie();
</script>

</body>
</html>
