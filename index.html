<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CHEF PRO</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<style>
body{margin:0;font-family:Arial;background:#111;color:#fff}
header{background:#000;padding:15px;text-align:center;font-size:22px;font-weight:bold}
nav{display:flex;justify-content:space-around;background:#1a1a1a;padding:10px}
nav button{background:none;border:none;color:#fff;font-size:16px}
section{padding:15px}
input,select,textarea,button{width:100%;margin-bottom:8px;padding:10px;border-radius:6px;border:none}
button{background:#fff;color:#000;font-weight:bold}
.card{background:#222;padding:10px;border-radius:6px;margin-bottom:10px}
.hidden{display:none}
.total{font-size:18px;font-weight:bold;margin-top:10px}
img{max-width:100%;border-radius:8px;margin-bottom:10px}

@media print{
nav,button,input,select,textarea{display:none}
body{background:#fff;color:#000}
}
</style>
</head>

<body>

<header>CHEF PRO</header>

<nav>
<button onclick="showPage('home')">âž• Nuova</button>
<button onclick="showPage('categorie')">ðŸ“‚ Ricette</button>
</nav>

<section id="home">
<h2>Nuova Ricetta</h2>

<input id="nome" placeholder="Nome ricetta">
<select id="categoria" onchange="toggleFoto()"></select>

<input type="file" id="foto" accept="image/*" capture="environment">

<textarea id="descrizione" placeholder="Procedimento"></textarea>

<h3>Ingredienti</h3>
<input id="ingNome" placeholder="Ingrediente">
<input id="ingQuantita" placeholder="QuantitÃ ">
<label><input type="checkbox" id="usaCosto"> Calcola food cost</label>
<input id="ingCosto" type="number" placeholder="Costo" class="hidden">
<button onclick="aggiungiIngredienteTemp()">Aggiungi ingrediente</button>

<div id="ingredientiTemp"></div>

<button onclick="salvaRicetta()">Salva ricetta</button>
</section>

<section id="categorie" class="hidden">
<input id="cerca" placeholder="Cerca ricette..." oninput="cercaRicette()">
<div id="risultatiRicerca"></div>
<h3>Categorie</h3>
<div id="listaCategorie"></div>
</section>

<section id="ricetta" class="hidden">
<h2 id="titoloRicetta"></h2>
<img id="imgRicetta">
<p id="testoRicetta"></p>

<h3>Ingredienti</h3>
<div id="listaIngredienti"></div>
<div class="total" id="totaleCosto"></div>

<button onclick="window.print()">ðŸ–¨ Stampa</button>
</section>

<script>
let categorie=["Antipasti","Primi","Secondi","Dolci","Preparazioni base"];
let ricette=JSON.parse(localStorage.getItem("ricette"))||[];
let tempIngredienti=[], fotoBase64=null, attiva=null;

usaCosto.onchange=()=>ingCosto.classList.toggle("hidden",!usaCosto.checked);

function showPage(id){
 document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
}

function toggleFoto(){
 foto.classList.toggle("hidden", categoria.value==="Preparazioni base");
}

foto.onchange=()=>{
 let f=foto.files[0];
 if(!f)return;
 let r=new FileReader();
 r.onload=()=>fotoBase64=r.result;
 r.readAsDataURL(f);
}

function aggiornaCategorie(){
 categoria.innerHTML="";
 categorie.forEach(c=>{
  let o=document.createElement("option");
  o.value=o.textContent=c;
  categoria.appendChild(o);
 });
 toggleFoto();
 listaCategorie.innerHTML="";
 categorie.forEach(c=>{
  let d=document.createElement("div");
  d.className="card";
  d.textContent=c;
  d.onclick=()=>mostraCategoria(c);
  listaCategorie.appendChild(d);
 });
}

function aggiungiIngredienteTemp(){
 if(!ingNome.value||!ingQuantita.value)return;
 tempIngredienti.push({
  nome:ingNome.value,
  quantita:ingQuantita.value,
  costo:usaCosto.checked?parseFloat(ingCosto.value)||null:null
 });
 ingNome.value="";ingQuantita.value="";ingCosto.value="";
 usaCosto.checked=false;ingCosto.classList.add("hidden");
 renderTemp();
}

function renderTemp(){
 ingredientiTemp.innerHTML="";
 tempIngredienti.forEach(i=>{
  ingredientiTemp.innerHTML+=
   `<div class="card">${i.nome} â€“ ${i.quantita} ${i.costo?"â‚¬ "+i.costo:"(costo non calcolato)"}</div>`;
 });
}

function salvaRicetta(){
 if(!nome.value)return;
 ricette.push({
  nome:nome.value,
  categoria:categoria.value,
  descrizione:descrizione.value,
  ingredienti:tempIngredienti,
  foto:categoria.value==="Preparazioni base"?null:fotoBase64
 });
 localStorage.setItem("ricette",JSON.stringify(ricette));
 nome.value="";descrizione.value="";foto.value="";
 tempIngredienti=[];fotoBase64=null;renderTemp();
}

function mostraCategoria(cat){
 risultatiRicerca.innerHTML="";
 ricette.filter(r=>r.categoria===cat).forEach(r=>{
  let d=document.createElement("div");
  d.className="card";
  d.textContent=r.nome;
  d.onclick=()=>mostraRicetta(r);
  risultatiRicerca.appendChild(d);
 });
}

function mostraRicetta(r){
 attiva=r;showPage("ricetta");
 titoloRicetta.textContent=r.nome;
 testoRicetta.textContent=r.descrizione;
 imgRicetta.src=r.foto||"";imgRicetta.style.display=r.foto?"block":"none";
 aggiornaIngredienti();
}

function aggiornaIngredienti(){
 listaIngredienti.innerHTML="";
 let tot=0, haCosto=false;
 attiva.ingredienti.forEach(i=>{
  if(i.costo){tot+=i.costo;haCosto=true;}
  listaIngredienti.innerHTML+=
   `<div class="card">${i.nome} â€“ ${i.quantita} ${i.costo?"â‚¬ "+i.costo:"(costo non calcolato)"}</div>`;
 });
 totaleCosto.textContent=haCosto?"Food cost totale: â‚¬ "+tot.toFixed(2):"";
}

function cercaRicette(){
 let t=cerca.value.toLowerCase();
 risultatiRicerca.innerHTML="";
 ricette.filter(r=>r.nome.toLowerCase().includes(t)).forEach(r=>{
  let d=document.createElement("div");
  d.className="card";
  d.textContent=r.nome+" ("+r.categoria+")";
  d.onclick=()=>mostraRicetta(r);
  risultatiRicerca.appendChild(d);
 });
}

aggiornaCategorie();
</script>

</body>
</html>
